<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Servicio Técnico</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/index.css" type="text/css">
</head>

<body>
    <div class="container mt-4">
        <!-- Título y botones fijos -->
        <div class="fixed-header">
            <h1>Servicio Técnico</h1><h3>MENU PRINCIPAL ADMINISTRADOR</h3>
            <div class="btn-group">
                <button class="btn btn-success"><a href="/new" class="text-white">Nueva Orden</a></button>
                <button class="btn btn-warning"><a href="/search" class="text-white">Buscar Orden</a></button>
                <a href="/database" class="btn btn-secondary">Abrir Database</a>
                <a href="/" class="btn btn-primary">Volver al Inicio</a>
            </div>
        </div>

        <!-- Selector de estado -->
        <div class="form-group">
            <br><br><br>
            <label for="filterEstado"><strong>FILTRAR POR ESTADO:</strong></label>
            <select id="filterEstado" class="form-control">
                <option value="PENDIENTE">Todas las Ordenes Pendientes</option>
                <option value="RETIRADO">Retirado</option>
                <option value="PRESUPUESTADO">Presupuestado</option>
                <option value="PRESUPUESTADO_AVISADO">Presupuestado Avisado</option>
                <option value="PRESUPUESTADO_APROBADO">Presupuestado Aprobado</option>
                <option value="RECHAZADO_A_DEVOLVER">Rechazado a Devolver</option>
                <option value="REPARADO">Reparado</option>
                <option value="REPARADO_AVISADO">Reparado Avisado</option>
                <option value="REVISAR">Revisar</option>
                <option value="LLAMAR">Llamar</option>
            </select>
        </div>

        <!-- Contenedor de órdenes -->
        <div class="row content-container" id="newForm">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <!-- Aquí se mostrarán las órdenes de servicio -->
                        <h4>ORDENES PENDIENTES</h4>
                        <div id="orders-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="fullscreen-image" id="fullscreenImageContainer">
        <img src="" alt="Fullscreen Image" id="fullscreenImage">
    </div>

    <script>
        // Código JavaScript
        const ordersContainer = document.getElementById("orders-container");
        const fullscreenImageContainer = document.getElementById("fullscreenImageContainer");
        const fullscreenImage = document.getElementById("fullscreenImage");
        const filterEstado = document.getElementById("filterEstado");

        // Cargar y mostrar las órdenes según el estado seleccionado
        function loadOrdersByEstado(selectedEstado) {
            fetch('/servicios')
                .then(response => response.json())
                .then(ordersData => {
                    const filteredOrders = ordersData.filter(order => order.estado === selectedEstado || selectedEstado === 'PENDIENTE' && order.estado !== 'RETIRADO');
                    displayOrders(filteredOrders);
                })
                .catch(error => console.error('Error al cargar los datos:', error));
        }

        function displayOrders(ordersData) {
            // Resto de tu código para mostrar las órdenes...
        }

        // Cargar órdenes iniciales (pendientes)
        loadOrdersByEstado('PENDIENTE');

        // Manejar evento de cambio de selección del estado
        filterEstado.addEventListener('change', () => {
            const selectedEstado = filterEstado.value;
            loadOrdersByEstado(selectedEstado);
        });

        function displayOrders(ordersData) {
    ordersContainer.innerHTML = "";
    ordersData.forEach(order => {
        const orderElement = document.createElement("div");
        orderElement.classList.add("order");
        orderElement.innerHTML = `
        <div class="order-summary">
            <strong>N° Orden:</strong> ${order.id}<br>
            <strong>Fecha de Ingreso:</strong> ${order.fecha_ingreso}<br>
            <strong>Cliente:</strong> ${order.nombre_cliente}<br>
            <strong>Estado:</strong> ${order.estado}<br>
        </div>
        <div class="order-details" style="display: none;">
            <strong>Teléfono:</strong> ${order.telefono}<br>
            <strong>Tipo de Equipo:</strong> ${order.tipo_equipo}<br>
            <strong>Marca:</strong> ${order.marca}<br>
            <strong>Modelo:</strong> ${order.modelo}<br>
            <strong>Número de Serie:</strong> ${order.numero_serie}<br>
            <strong>Accesorios:</strong> ${order.accesorios}<br>
            <strong>Tareas:</strong> ${order.tareas}<br>
            <strong>Estado:</strong> ${order.estado}<br>
            <strong>Observaciones:</strong> ${order.observaciones}<br>
            <strong>Foto:</strong> ${order.foto ? `<img src="/img/${order.foto}" alt="Foto" width="200" class="fullscreenable-image" data-src="/img/${order.foto}">` : "N/A"}<br>
            <strong>Fecha de Retiro:</strong> ${order.fecha_retiro ? order.fecha_retiro : "NO RETIRADO AUN"}<br>
            <br>
            <a href="/edit/${order.id}" class="btn btn-primary btn-sm edit-btn">Editar</a>
            <a href="/print/${order.id}" class="btn btn-secondary btn-sm print-btn">Imprimir</a>
            </div>
    `;

        const orderSummary = orderElement.querySelector(".order-summary");
        const orderDetails = orderElement.querySelector(".order-details");
        let isDetailsVisible = false;

        orderSummary.addEventListener("click", () => {
            isDetailsVisible = !isDetailsVisible;

            if (isDetailsVisible) {
                orderDetails.style.display = "block";
            } else {
                orderDetails.style.display = "none";
            }
        });

        const fullscreenableImages = orderElement.querySelectorAll(".fullscreenable-image");
        fullscreenableImages.forEach(image => {
            image.addEventListener("click", () => {
                fullscreenImage.src = image.getAttribute("data-src");
                fullscreenImageContainer.style.display = "flex";
            });
        });

        const separator = document.createElement("hr");
        separator.style.marginTop = "1px";
        orderElement.appendChild(separator);

        ordersContainer.appendChild(orderElement);
    });

    // const deleteButtons = document.querySelectorAll('.delete-btn');
    // deleteButtons.forEach(button => {
    //     button.addEventListener('click', async () => {
    //         const orderId = button.getAttribute('data-order-id');
    //         const response = await fetch(`/delete/${orderId}`, { method: 'POST' });
    //         if (response.ok) {
    //             location.reload();
    //         }
    //     });
    // });

    fullscreenImageContainer.addEventListener("click", () => {
        fullscreenImageContainer.style.display = "none";
        fullscreenImage.src = "";
    });
}
    </script>
</body>

</html>
