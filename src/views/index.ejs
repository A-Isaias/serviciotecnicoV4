<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Servicio Técnico</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/index.css" type="text/css">
</head>

<body>
    <div class="container mt-4">
        <h1 class="mb-4">Servicio Técnico</h1>

        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <!-- Aquí se mostrarán las órdenes de servicio -->
                        <div id="orders-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col">
                <button class="btn btn-success mr-2"><a href="/new" class="text-white">Nueva Orden</a></button>
                <button class="btn btn-warning mr-2"><a href="/search" class="text-white">Buscar Orden</a></button>
            </div>
        </div>
    </div>

    <script>
        // Código JavaScript
        const ordersContainer = document.getElementById("orders-container");
    
        // Carga los datos del archivo JSON
        fetch('/servicios')
            .then(response => response.json())
            .then(ordersData => {
                displayOrders(ordersData);
            })
            .catch(error => console.error('Error al cargar los datos:', error));
    
        // Función para mostrar las órdenes en el contenedor
        function displayOrders(ordersData) {
            ordersContainer.innerHTML = "";
            ordersData.forEach(order => {
                const orderElement = document.createElement("div");
                orderElement.classList.add("order");
                orderElement.innerHTML = `
                    <div class="order-summary">
                        <strong>ID:</strong> ${order.id}<br>
                        <strong>Cliente:</strong> ${order.nombre_cliente}<br>
                    </div>
                    <div class="order-details" style="display: none;">
                        <strong>Teléfono:</strong> ${order.telefono}<br>
                        <strong>Tipo de Equipo:</strong> ${order.tipo_equipo}<br>
                        <strong>Marca:</strong> ${order.marca}<br>
                        <strong>Modelo:</strong> ${order.modelo}<br>
                        <strong>Número de Serie:</strong> ${order.numero_serie}<br>
                        <strong>Accesorios:</strong> ${order.accesorios}<br>
                        <strong>Tareas:</strong> ${order.tareas}<br>
                        <a href="/edit/${order.id}" class="btn btn-primary">Editar</a>
                        <button class="btn btn-danger delete-btn" data-order-id="${order.id}">Borrar</button>
                        <a href="/print/${order.id}" class="btn btn-secondary">Imprimir</a>
                    </div>
                `;
    
                // Agregar un controlador de evento para alternar la visibilidad de los detalles
                const orderSummary = orderElement.querySelector(".order-summary");
                const orderDetails = orderElement.querySelector(".order-details");
                let isDetailsVisible = false;
    
                orderSummary.addEventListener("click", () => {
                    isDetailsVisible = !isDetailsVisible;
    
                    if (isDetailsVisible) {
                        orderDetails.style.display = "block";
                    } else {
                        orderDetails.style.display = "none";
                    }
                });
    
                ordersContainer.appendChild(orderElement);
            });
    
            // Agregar un controlador de evento para el botón de borrar
            const deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', async () => {
                    const orderId = button.getAttribute('data-order-id');
                    const response = await fetch(`/delete/${orderId}`, { method: 'POST' });
                    if (response.ok) {
                        // Recargar la página después de borrar
                        location.reload();
                    }
                });
            });
        }
    
        // Resto de tu código...
    </script>
</body>

</html>
