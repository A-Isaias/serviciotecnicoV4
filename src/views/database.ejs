<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Servicio Técnico</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/database.css" type="text/css">
</head>

<body>
    <header>
    <!-- Título "ORDENES PENDIENTES" -->
    <!-- <h4 id="titulo">BASE DE DATOS</h4> -->

    <!-- Tabla para mostrar las órdenes -->
    <div class="fixed-header">
        <h3 id="titulo">Vista completa de base de datos</h3>
        <div class="staticButtons">
            <div class="btn-group">
                <button class="btn btn-success"><a href="/new" class="text-white">Nueva Orden</a></button>
                <button class="btn btn-warning"><a href="/search" class="text-white">Buscar Orden</a></button>
                <a href="/" class="btn btn-primary">Volver al Inicio</a>
            </div>
        </div>
    </div>    
    <div class="float-right">
        <div class="btn-group">
            <a href="#titulo" class="btn btn-secondary">Volver Arriba</a>
            <a href="/" class="btn btn-primary">Volver al Inicio</a>
        </div>
    </div>
    
    </header>
    <table class="table" id="table">
        <thead class="sticky-header">
            <tr>
                <th>Orden</th>
                <th>Ingreso</th>
                <th>Cliente</th>
                <th>Teléfono</th>
                <th>Tipo Equipo</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>N° de Serie</th>
                <th>Accesorios</th>
                <th>Tareas</th>
                <th>Estado</th>
                <th>Observaciones</th>
                <th>Fecha de Retiro</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="orders-container">
            <!-- Aquí se mostrarán las órdenes de servicio -->
        </tbody>
    </table>
    </div>
    
        <!-- <div class="fullscreen-image" id="fullscreenImageContainer">
        <img src="" alt="Fullscreen Image" id="fullscreenImage">
    </div> -->

        <script>
            // Código JavaScript
            const ordersContainer = document.getElementById("orders-container");
    
            // Función de confirmación de borrado
            function confirmDelete(orderId) {
                if (confirm(`¿ESTA SEGURO DE QUE QUIERE BORRAR LA ORDEN N°: ${orderId}?`)) {
                    fetch(`/delete/${orderId}`, { method: 'POST' })
                        .then(response => {
                            if (response.ok) {
                                // Recargar la página después de borrar
                                location.reload();
                            }
                        })
                        .catch(error => console.error('Error al borrar el registro:', error));
                }
            }
    
            // Carga los datos del archivo JSON
            fetch('/servicios')
                .then(response => response.json())
                .then(ordersData => {
                    displayOrders(ordersData);
                })
                .catch(error => console.error('Error al cargar los datos:', error));
    
            // Función para mostrar las órdenes en la tabla
            function displayOrders(ordersData) {
                ordersContainer.innerHTML = "";
                ordersData.forEach(order => {
                    const orderRow = document.createElement("tr");
                    orderRow.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.fecha_ingreso}</td>
                    <td>${order.nombre_cliente}</td>
                    <td>${order.telefono}</td>
                    <td>${order.tipo_equipo}</td>
                    <td>${order.marca}</td>
                    <td>${order.modelo}</td>
                    <td>${order.numero_serie}</td>
                    <td>${order.accesorios}</td>
                    <td>${order.tareas}</td>
                    <td>${order.estado}</td>
                    <td>${order.observaciones}</td>
                    <td>${order.fecha_retiro ? order.fecha_retiro : "NO RETIRADO AUN"}</td>
                    <td>
                        <button class="btn btn-primary btn-sm same-size-btn"><a href="/edit/${order.id}" class="text-white">Editar</a></button>
                        <button class="btn btn-secondary btn-sm same-size-btn"><a href="/print/${order.id}" class="text-white">Imprimir</a></button>
                        <button class="btn btn-danger delete-btn btn-sm same-size-btn" onclick="confirmDelete(${order.id})">Borrar</button>
                    </td>
                `;
    
                    ordersContainer.appendChild(orderRow);
                });
            }
        </script>
    </body>
    
    </html>